Index: monopoly/Menu.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package monopoly;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.HashSet;\r\nimport java.util.Scanner;\r\nimport java.util.Set;\r\n\r\nimport partida.*;\r\n\r\npublic class Menu {\r\n    //Atributos\r\n    private ArrayList<Jugador> jugadores; //Jugadores de la partida\r\n    private ArrayList<Avatar> avatares; //Avatares en la partida.\r\n    private int turno = 0; //Índice correspondiente a la posición en el arrayList del jugador (y el avatar) que tienen el turno\r\n    private int lanzamientos=0; //Variable para contar el número de lanzamientos de un jugador en un turno.\r\n    private Tablero tablero; //Tablero en el que se juega.\r\n    private Dado dado1; //Dos dados para lanzar y avanzar casillas.\r\n    private Dado dado2;\r\n    private boolean tirado; //Booleano para comprobar si el jugador que tiene el turno ha tirado o no.\r\n    private boolean solvente=true; //Booleano para comprobar si el jugador que tiene el turno es solvente, es decir, si ha pagado sus deudas.\r\n    private Jugador banca; //Jugador que representa a la banca.\r\n    private boolean partidaIniciada=false; //Booleano para comprobar si la partida ha comenzado (mínimo 2 jugadores creados).\r\n    private boolean partidaFinalizada = false;\r\n    private boolean comandos = false;\r\n\r\n    public Menu(){\r\n        Scanner scanner = new Scanner(System.in);\r\n        String comando;\r\n        this.banca = new Jugador();\r\n        this.tablero = new Tablero(this.banca);\r\n        this.jugadores = new ArrayList<Jugador>();\r\n        this.avatares = new ArrayList<Avatar>();\r\n        this.dado1 = new Dado();\r\n        this.dado2 = new Dado();\r\n        while(!partidaFinalizada){\r\n            System.out.println(tablero);\r\n            if(partidaIniciada){ //Mostramos o nome do xogador que ten o turno\r\n                System.out.print(\"\\nTurno de \"+\"\\033[1m\" + jugadores.get(turno).getNombre() + \": \\033[0m\");\r\n            }else{ //Se a partida non comezou, mostramos o prompt xenérico\r\n                System.out.print(\"\\n\\033[1m$:\\033[0m\");\r\n            }\r\n            comando = scanner.nextLine();\r\n            System.out.print(\"\\n\");\r\n            analizarComando(comando);\r\n\r\n        }\r\n        System.out.println(\"\\n/---------------/\\n\");\r\n        System.out.println(\"Créditos\");\r\n\r\n    }\r\n\r\n    public Tablero getTablero() {\r\n        return tablero;\r\n    }\r\n\r\n    private void iniciarPartida() {\r\n    }\r\n    \r\n    /*\r\n     * Método que analiza el comando introducido por el usuario y llama a los métodos correspondientes.\r\n     * Parámetro: cadena de caracteres con el comando introducido.\r\n    */\r\n    private void analizarComando(String comando) {\r\n        String[] cmdseparado = comando.split(\" \"); //Separamos el comando por espacios para analizarlo mejor, .split(\" \") separa en cada espacio\r\n        switch (cmdseparado[0]){\r\n            case \"crear\":\r\n                if(cmdseparado.length!=4){\r\n                    Valor.error(\"Comando introducido erróneo\");\r\n                    System.out.println(\"Uso: crear jugador nombre tipoAvatar\\n\");\r\n                    break;\r\n                }\r\n                crearxogador(cmdseparado);\r\n                break;\r\n            case \"describir\":\r\n                describir(cmdseparado);\r\n                break;\r\n            case \"jugador\":\r\n                xogadorTurno();\r\n                break;\r\n            case \"ver\":\r\n            if(comandos)\r\n                {System.out.println(tablero);}\r\n                break;\r\n            case \"listar\":\r\n                listar(cmdseparado);\r\n                break;\r\n            case \"empezar\":\r\n                iniciarPartida();\r\n                break;\r\n            case \"lanzar\":\r\n                if(cmdseparado.length<2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: lanzar dados  -  lanzar dados dado1+dado2\\n\");\r\n                    break;\r\n                }\r\n                if(cmdseparado[1].equalsIgnoreCase(\"dados\")){\r\n                    lanzarDados(cmdseparado);\r\n                }\r\n                break;\r\n            case \"salir\":\r\n                if(cmdseparado.length<2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: salir carcel\");\r\n                    break;\r\n                }\r\n                if(cmdseparado[1].equalsIgnoreCase(\"cárcel\") || cmdseparado[1].equalsIgnoreCase(\"carcel\")){\r\n                    salirCarcelPagando();\r\n                    break;\r\n                }\r\n                    salirCarcel();\r\n                break;\r\n            case \"acabar\":\r\n                acabarTurno();\r\n                break;\r\n            case \"comprar\":\r\n                if(cmdseparado.length<2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: comprar <propiedad>\");\r\n                    break;\r\n                }\r\n                comprar(cmdseparado[1]);\r\n                break;\r\n            case \"comandos\":\r\n                if(cmdseparado.length < 2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: comandos <archivo>\");\r\n                    break;\r\n                }\r\n                leerArquivo(cmdseparado[1]);\r\n                break;\r\n            case \"estadisticas\":\r\n                if(!partidaIniciada){\r\n                    Valor.error(\"A partida aínda non comezou, non hai estatísticas que mostrar.\");\r\n                    break;\r\n                }\r\n                if (cmdseparado.length < 2){\r\n                    estadisticasPartida();\r\n                    break;\r\n                }else if(cmdseparado.length>3)\r\n                {\r\n                    Valor.error(\"Numero de comandos erróneo\");\r\n                    System.out.println(\"Uso: estadisticas <opcional: jugador>\");\r\n                    break;\r\n                }\r\n                estadisticasXogador(cmdseparado);\r\n                break;\r\n            case \"edificar\":\r\n                if(!partidaIniciada){\r\n                    Valor.error(\"A partida aínda non comezou, non se poden edificar edificios.\");\r\n                    break;\r\n                }\r\n                if(cmdseparado.length<2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: edificar <propiedad>\");\r\n                    break;\r\n                }\r\n                edificar(cmdseparado);\r\n                break;\r\n            case \"vender\":\r\n                if(!partidaIniciada){\r\n                    Valor.error(\"A partida aínda non comezou, non se poden vender edificios.\");\r\n                    break;\r\n                }\r\n                if(cmdseparado.length<4){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: vender <tipo> <solar> <cantidade>\");\r\n                    break;\r\n                }\r\n                \r\n                vender(cmdseparado);\r\n                break;\r\n            case \"hipotecar\":\r\n                if (!partidaIniciada){\r\n                    Valor.error(\"A partida aínda non comezou, non se poden hipotecar propiedades.\");\r\n                    break;\r\n                }\r\n                if (cmdseparado.length < 2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: hipotecar <propiedad>\");\r\n                    break;\r\n                }\r\n                hipotecar(cmdseparado);\r\n                break;\r\n            case \"deshipotecar\":\r\n                if (!partidaIniciada){\r\n                        Valor.error(\"A partida aínda non comezou, non se poden hipotecar propiedades.\");\r\n                        break;\r\n                    }\r\n                if (cmdseparado.length < 2){\r\n                    Valor.error(\"Número de argumentos erróneo.\");\r\n                    System.out.println(\"Uso: deshipotecar <propiedad>\");\r\n                    break;\r\n                }\r\n                deshipotecar(cmdseparado);\r\n                break;\r\n            case \"axuda\":\r\n                Valor.error(\"Número de argumentos erróneo.\");\r\n                System.out.println(\"Uso: axuda\");\r\n                mostrarAxuda();\r\n                break;\r\n            default:\r\n                Valor.error(\"\\nComando introducido erróneo.\\n\");\r\n\r\n                break;\r\n\r\n        }\r\n    }\r\n\r\n    /*\r\n     *Método que realiza as accións asociadas ao comando 'listar'.\r\n     * Parámetro: array de cadenas de caracteres con las partes del comando. \r\n    */\r\n    private void listar(String[] partes){\r\n        if(partes.length<2){\r\n            Valor.error(\"Non inseriu o número de comandos suficientes\");\r\n            System.out.println(\"Uso: listar jugadores\\nUso: listar enventa\\nUso: listar edificios <opcional: colorGrupo>\");\r\n        }\r\n        if(partes[1].equalsIgnoreCase(\"jugadores\")){\r\n            listarJugadores();\r\n        }else if(partes[1].equalsIgnoreCase(\"enventa\")){\r\n            listarVenta();\r\n        }else if(partes[1].equalsIgnoreCase(\"edificios\") && partes.length==2){\r\n            listarEdificios();\r\n        }else if(partes[1].equalsIgnoreCase(\"edificios\") && partes.length==3){\r\n            listarEdificiosGrupo(partes[2]);\r\n        }else{\r\n            Valor.error(\"Comando introducido erróneo.\");\r\n        }\r\n    }\r\n\r\n    /*\r\n     *Método que realiza as accións asociadas ao comando 'describir'.\r\n     * Parámetro: array de cadenas de caracteres con las partes del comando. \r\n    */\r\n    private void describir(String[] partes){\r\n        if(partes.length < 2 || partes.length > 3){\r\n            Valor.error(\"Número de parámetros incorrecto\");\r\n            System.out.println(\"Uso: describir jugador nombreJugador\\nUso: describir nombreCasilla\");\r\n            return;\r\n        }\r\n        if(partes[1].equalsIgnoreCase(\"jugador\")&& partes.length==3){\r\n            descJugador(partes);\r\n        }else{\r\n            descCasilla(partes);\r\n        }\r\n    }\r\n\r\n    /*\r\n     *Método que crea un xogador coa información dada no comando.\r\n     * Parámetro: nome do xogador a crear. \r\n    */\r\n    private void crearxogador(String[] partes) {\r\n        if(partidaIniciada){\r\n            Valor.error(\"A partida xa comezou. Non se poden engadir máis xogadores.\");\r\n            return;\r\n        }\r\n        if(partes.length !=4){\r\n            Valor.error(\"Número de parámetros incorrecto.\");\r\n            System.out.println(\"Uso: crear jugador nome tipoAvatar\");\r\n            return;\r\n        }\r\n        if(jugadores.size()==4){\r\n            Valor.error(\"Número máximo de xogadores alcanzado (4).\");\r\n            return;\r\n        }\r\n        if(!partes[3].equalsIgnoreCase(\"coche\")&&!partes[3].equalsIgnoreCase(\"sombrero\")&&!partes[3].equalsIgnoreCase(\"esfinge\")&&!partes[3].equalsIgnoreCase(\"pelota\"))    {\r\n            Valor.error(\"Tipo de avatar non válido. Os tipos dispoñibles son: coche, sombrero, esfinge e pelota.\");\r\n                return;\r\n        }\r\n        for(Jugador aux:jugadores){\r\n            if(aux.getNombre().equals(partes[2])){\r\n                Valor.error(\"Xa existe un xogador co nome \"+partes[2]+\".\");\r\n                return;\r\n            }\r\n            else if(aux.getAvatar().getTipo().equalsIgnoreCase(partes[3])){\r\n                Valor.error(\"Xa existe un xogador co avatar \"+partes[3]+\".\");\r\n                return;\r\n            }\r\n        }\r\n        Casilla auxsal = tablero.encontrar_casilla(\"Salida\"); //Colocamos o xogador creado na casilla de saída\r\n        Jugador nuevo= new Jugador(partes[2],partes[3],auxsal,avatares);\r\n\r\n        jugadores.add(nuevo);\r\n        auxsal.anhadirAvatar(nuevo.getAvatar());\r\n    }\r\n\r\n    /*\r\n     *Describe un xogador dado polo nome.\r\n     * Parámetro: nome do xogador a describir. \r\n    */\r\n    private void descJugador(String[] partes) {\r\n        if(jugadores.isEmpty()){\r\n            Valor.error(\"Non hai xogadores aínda.\");\r\n            return;\r\n        }\r\n        //System.out.println(\"Nome do xogador a describir: \"+partes[2] );\r\n        boolean encontrado = false;\r\n        for(Jugador aux:jugadores){\r\n            if(aux.getNombre().equals(partes[2])){\r\n                System.out.println(aux);\r\n                encontrado = true;\r\n                break;\r\n            }\r\n        }\r\n        if(!encontrado){\r\n            Valor.error(\"Non existe un xogador co nome\" + partes[2]);\r\n        }\r\n    }\r\n    \r\n    /*\r\n    private void descAvatar(String ID) {\r\n\r\n        for(Avatar aux:avatares){\r\n            if(aux.getId().equals(ID)){\r\n                System.out.println(aux.getId());\r\n            }\r\n        }\r\n    }\r\n    */\r\n\r\n    /*\r\n     *Describe unha casilla dado polo nome.\r\n     * Parámetro: nome da casilla a describir.\r\n    */\r\n    private void descCasilla(String[] nombre) {\r\n        Casilla aux =tablero.encontrar_casilla(nombre[1]);\r\n        if(aux != null){\r\n            System.out.println(aux);\r\n        }else{\r\n            Valor.error(\"Non existe ningunha casilla chamada \" + nombre[1]);\r\n        }\r\n    }\r\n\r\n    /*\r\n     *Mostra a información do xogador que ten o turno.\r\n     * Parámetro: -\r\n    */\r\n    private void xogadorTurno(){\r\n        Jugador jugadorActual = jugadores.get(turno);\r\n        System.out.println(jugadorActual);\r\n    }\r\n\r\n    /*\r\n     *Lánzanse os dados e móvese o avatar do xogador que ten o turno.\r\n     * Parámetro: os números dos dados (opcional).\r\n    */ \r\n    private void lanzarDados(String[] partes) {\r\n        if(partidaIniciada==false && jugadores.size()>=2){\r\n            partidaIniciada=true;\r\n            System.out.println(\"\\033[1m\\nA partida comezou\\033[0m\\n\");\r\n        }\r\n        else if(partidaIniciada==false && jugadores.size()<2){\r\n            Valor.error(\"A partida aínda non comezou, necesítanse dous xogadores.\");\r\n            return;\r\n        }\r\n\r\n        boolean forzar=false;\r\n        if(partes.length == 3) {\r\n            forzar = true;\r\n        }\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        //System.out.println(jugadorActual);\r\n        if(tirado){\r\n            Valor.error(\"Xa tirou os dados este turno.\");\r\n            return;\r\n        }\r\n\r\n        int valor1;\r\n        int valor2;\r\n        if (forzar) {\r\n            String[] dadoforzado = partes[2].split(\"\\\\+\");\r\n            valor1 = Integer.parseInt(dadoforzado[0]);\r\n            valor2 = Integer.parseInt(dadoforzado[1]);\r\n        }else {\r\n            valor1 = dado1.hacerTirada();\r\n            valor2 = dado2.hacerTirada();\r\n        }\r\n        if(jugadorActual.getEnCarcel()){ //Se o xogador está na cárcere\r\n            if (valor1==valor2){ //Se saca dobles, sae da cárcere\r\n                jugadorActual.setEnCarcel(false);\r\n                lanzamientos=0;\r\n                tirado=false;\r\n                System.out.println(\"\\nSacaches un \"+\"\\033[1m\"+valor1+\" e un \"+valor2+\"\\033[0m. Saíches do cárcere.\\n\");\r\n                return;\r\n            }else{\r\n                jugadorActual.sumartiradascarcel();\r\n                System.out.println(\"\\nSegues na cárcere. Levas \"+\"\\033[1m\"+jugadorActual.getTiradasCarcel()+\" turnos.\\033[0m\\n\");\r\n                tirado =true;\r\n                return;\r\n            }\r\n        }\r\n\r\n        if(lanzamientos==2 && valor1==valor2){\r\n            System.out.println(\"\\nSacaches tres dobles seguidos, \\033[1mvas ao cárcere.\\033[0m\\n\");\r\n            jugadorActual.encarcelar(tablero.getPosiciones());\r\n            lanzamientos=0;\r\n            tirado=true;\r\n            return;\r\n        }\r\n        lanzamientos++;\r\n        System.out.println(\"Sacaches un \"+\"\\033[1m\"+valor1+\" e un \"+valor2+\"\\033[0m.\\n\");\r\n        jugadorActual.getAvatar().moverAvatar(tablero.getPosiciones(),valor1+valor2);\r\n\r\n        solvente = jugadorActual.getAvatar().getLugar().evaluarCasilla(jugadorActual,banca,valor1+valor2, getTablero().getPosiciones());\r\n\r\n        tirado=true;\r\n        if(valor1==valor2&&!jugadorActual.getEnCarcel()){\r\n            System.out.println(\"Sacaches dobles\");\r\n            tirado=false;\r\n            return;\r\n        }\r\n    }\r\n\r\n    /*\r\n     *Sale da cárcere pagando a fianza.\r\n     * Parámetro: - \r\n    */\r\n    private void salirCarcelPagando(){\r\n        Jugador actual=jugadores.get(turno);\r\n        if(!actual.getEnCarcel()){\r\n            Valor.error(\"Non estás no cárcere\");\r\n            return;\r\n        }\r\n        if(actual.getFortuna()<500000000){\r\n            Valor.error(\"Non tes cartos de abondo para saír do cárcere.\" + \"\\033[1m Precisas 500000€, e tes \"+String.format(\"%.0f\", actual.getFortuna())+\"€\\033[0m\");\r\n            return;\r\n        }\r\n        if(tirado){\r\n            Valor.error(\"Xa tiraches os dados\");\r\n            return;\r\n        }\r\n        else{\r\n            actual.sumarFortuna(-500000);\r\n            actual.getEstatisticas().acImpPagado(500000);\r\n            actual.setEnCarcel(false);\r\n            System.out.println(actual.getNombre()+\" pagaches a cuota de 500000€ e saíches do cárcere, podes tirar os dados.\");\r\n            return;\r\n        }\r\n    }\r\n\r\n    /*\r\n     *Compras a propiedade na que está o avatar do xogador que ten o turno.\r\n     * Parámetro: nome da casilal a comprar. \r\n    */\r\n    private void comprar(String nombre) {\r\n        if(!solvente){\r\n            Valor.error(\"O xogador actual non é solvente, non pode facer compras ata pagar as súas débedas.\");\r\n            return;\r\n        }\r\n        Casilla casillaComprar = tablero.encontrar_casilla(nombre);\r\n        if(casillaComprar == null){\r\n            Valor.error(\"Non existe ningunha casilla co nome \"+ nombre);\r\n            return;\r\n        }\r\n        if(!\"Solar\".equals(casillaComprar.getTipo()) && !\"Transportes\".equals(casillaComprar.getTipo()) && casillaComprar.getTipo()!=\"Servicios\"){\r\n            Valor.error(\"Esa casilla non é mercable, so podes comprar casillas de tipo Solar, Transporte o Servicio.\");\r\n            return;\r\n        }\r\n        if(casillaComprar.getDuenho() != banca){\r\n            Valor.error(\"Esa casilla xa ten dono, é de \"+casillaComprar.getDuenho().getNombre()+\".\");\r\n            return;\r\n        }\r\n        \r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        if(jugadorActual.getAvatar().getLugar() != casillaComprar){\r\n            Valor.error(\"Non estás nesa casilla que queres comprar.\");\r\n            return;\r\n        }\r\n        if(jugadorActual.getFortuna() < casillaComprar.getValor()){\r\n            Valor.error(\"Non tes suficiente fortuna para comprar a casilla, a casilla costa \"+casillaComprar.getValor()+\" e ti tes aforrado \"+jugadorActual.getFortuna()+\"€\");\r\n            return;\r\n        }\r\n        casillaComprar.comprarCasilla(jugadorActual, banca);\r\n\r\n    }\r\n\r\n    private void edificar(String[] partes){\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        if(!partes[1].equals(\"casa\")&&!partes[1].equals(\"hotel\")&&!partes[1].equals(\"piscina\")&&!partes[1].equals(\"deporte\")){\r\n            Valor.error(\"Tipo de edificio non válido. Podes construir casa, hotel, piscina ou deporte.\");\r\n            return;\r\n        }\r\n\r\n        Casilla casillaEdificar = jugadorActual.getAvatar().getLugar();\r\n\r\n        if(casillaEdificar.getDuenho() != jugadorActual){\r\n            Valor.error(\"Non estás na túa propiedade.\");\r\n            return;\r\n        }\r\n\r\n        ArrayList<Casilla> casillasGrupo = casillaEdificar.getGrupo().getMiembros();\r\n\r\n        for(Casilla aux: casillasGrupo){\r\n            if(aux.getHipotecada()){\r\n                Valor.error(\"Non podes edificar neste grupo porque algunha casilla do grupo está hipotecada.\");\r\n                return;\r\n            }\r\n        }\r\n        \r\n        if(!casillaEdificar.getGrupo().esDuenhoGrupo(jugadorActual)){\r\n            Valor.error(\"Necesitas comprar todas as casillas do grupo para poder edificar nesta casilla\");\r\n            return;\r\n        }\r\n\r\n        casillaEdificar.edificar(partes[1], jugadorActual);\r\n    }\r\n\r\n    private void vender(String[] partes){\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n\r\n        if(Integer.parseInt(partes[3]) <=0){\r\n            Valor.error(\"A cantidade ten que ser maior que 0.\");\r\n            return;\r\n        }\r\n\r\n        if(!partes[1].equals(\"casa\")&&!partes[1].equals(\"hotel\")&&!partes[1].equals(\"piscina\")&&!partes[1].equals(\"deporte\")){\r\n            Valor.error(\"Tipo de edificio non válido. Podes vender casa, hotel, piscina ou deporte.\");\r\n            return;\r\n        }\r\n        Casilla casilla = tablero.encontrar_casilla(partes[2]);        \r\n        if(casilla==null){\r\n            Valor.error(\"Non existe ningunha casilla co nome.\"+ partes[2]);\r\n            return;\r\n        }\r\n        if(casilla.getDuenho() != jugadorActual){\r\n            Valor.error(\"A casilla \"+casilla.getNombre()+\"non é da túa propiedade.\");\r\n            return;\r\n        }\r\n        if(!casilla.getGrupo().esDuenhoGrupo(jugadorActual)){\r\n            Valor.error(\"Non eres dueño de todas as casillas do grupo, por tanto non hai edificios que vender nelas\");\r\n            return;\r\n        }\r\n        //Como paso partes[3] a tipo int??\r\n    \r\n        casilla.vender(partes[1], Integer.parseInt(partes[3]), jugadorActual);\r\n    }\r\n    \r\n    //Metodo que ejecuta todas las acciones relacionadas con el comando 'salir carcel'.\r\n    private void salirCarcel() {\r\n        if(jugadores.isEmpty()){\r\n            Valor.error(\"Non hai xogadores creados todavía.\");\r\n            return;\r\n        }\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        if(!jugadorActual.getEnCarcel()){\r\n            Valor.error(\"Non estás no cárcere.\");\r\n            return;\r\n        }\r\n        else{\r\n            jugadorActual.setEnCarcel(false);\r\n\r\n            System.out.println(\"Saíches do cárcere.\");\r\n        }\r\n    }\r\n\r\n    // Metodo que realiza las acciones asociadas al comando 'listar enventa'.\r\n    private void listarVenta() {\r\n        ArrayList<ArrayList<Casilla>> pos = tablero.getPosiciones();\r\n        for (ArrayList<Casilla> lado : pos) {\r\n            for (Casilla casilla : lado) {\r\n                if (casilla.getDuenho() == banca && (\"Solar\".equals(casilla.getTipo()) || \"Transportes\".equals(casilla.getTipo()) || \"Servicios\".equals(casilla.getTipo()))) {\r\n                    System.out.println(casilla);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Metodo que realiza las acciones asociadas al comando 'listar jugadores'.\r\n    private void listarJugadores() {\r\n        for(Jugador aux:jugadores){\r\n            System.out.println(aux);\r\n        }\r\n    }\r\n\r\n    private void listarEdificios(){\r\n        boolean atopou=false;\r\n        ArrayList<ArrayList<Casilla>> pos = tablero.getPosiciones();\r\n        for (ArrayList<Casilla> lado : pos) {\r\n            for (Casilla casilla : lado) {\r\n                if(!casilla.getTipo().equals(\"Solar\")){\r\n                    continue;\r\n                }else if(casilla.getDuenho()==banca){\r\n                    continue;\r\n                }\r\n                Edificios edificioCasa = casilla.getEdificios().get(\"casa\");\r\n                if(edificioCasa.getNumCasas() > 0){\r\n                    atopou=true;\r\n                    System.out.println(edificioCasa);\r\n                }\r\n                Edificios edificioUnico;\r\n                for(String tipo : new String[]{\"hotel\", \"piscina\", \"deporte\"}){\r\n                    edificioUnico = casilla.getEdificios().get(tipo);\r\n                    if(edificioUnico.getTenEdificio()){\r\n                        atopou=true;\r\n                        System.out.println(edificioUnico);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(!atopou){\r\n            Valor.error(\"\\nNon hai edificios construídos no tablero.\\n\");\r\n        }\r\n    }\r\n\r\n    private void listarEdificiosGrupo(String colorGrupo){\r\n        boolean atopou=false;\r\n        ArrayList<ArrayList<Casilla>> pos = tablero.getPosiciones();\r\n        int casas=0;\r\n        boolean hotel=false, piscina=false, deporte=false;\r\n        for (ArrayList<Casilla> lado : pos) {\r\n            for (Casilla casilla : lado) {\r\n                if(!casilla.getTipo().equals(\"Solar\")){\r\n                    continue;\r\n                }else if(casilla.getDuenho()==banca){\r\n                    continue;\r\n                }\r\n                if(Valor.getNombreColor(casilla.getGrupo().getColorGrupo()).equalsIgnoreCase(colorGrupo)){        \r\n                    Edificios edificioCasa = casilla.getEdificios().get(\"casa\");\r\n                    if(edificioCasa.getNumCasas() > 0){\r\n                        casas=edificioCasa.getNumCasas();\r\n                        System.out.println(edificioCasa);\r\n                    }\r\n                    Edificios edificioUnico;\r\n                    for(String tipo : new String[]{\"hotel\", \"piscina\", \"deporte\"}){\r\n                        edificioUnico = casilla.getEdificios().get(tipo);\r\n                        if(edificioUnico.getTenEdificio()){\r\n                            if(tipo.equals(\"hotel\")){\r\n                                hotel=true;\r\n                            }else if(tipo.equals(\"piscina\")){\r\n                                piscina=true;\r\n                            }else if(tipo.equals(\"deporte\")){\r\n                                deporte=true;\r\n                            }\r\n                            System.out.println(edificioUnico);\r\n                        }\r\n                    }\r\n                    atopou=true;\r\n                }\r\n            }\r\n        }\r\n        if(!atopou){\r\n            System.out.println(\"Non hai edificios construídos neste grupo de cor ou a cor non é válida.\");\r\n            return;\r\n        }else{\r\n            if(deporte){\r\n                System.out.println(\"Xa non podes construír máis edificios neste grupo.\");\r\n                return;\r\n            }\r\n            if(piscina){\r\n                System.out.println(\"Xa non podes construír máis casas, hoteis nin piscinas, pero aínda podes construír un deporte.\");\r\n                return;\r\n            }\r\n            if(hotel){\r\n                System.out.println(\"Xa non podes construír máis casas nin hoteis, pero aínda podes construír unha piscina e un deporte.\");\r\n                return;\r\n            }\r\n            if(casas == 4){\r\n                System.out.println(\"Xa non podes construír máis casas neste grupo, pero aínda podes construír un hotel, unha piscina e un deporte.\");\r\n            }\r\n            if(casas < 4){\r\n                System.out.println(\"Aínda podes construír \"+(4-casas)+\" casas neste grupo, un hotel, unha piscina e un deporte.\");\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    //Hai que ter todos os edificios dun grupo para poder hipotecar unha propiedade???? no\r\n    private void hipotecar(String[] partes){\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        Casilla casillaHipotecar = tablero.encontrar_casilla(partes[1]);    \r\n        if(casillaHipotecar==null){\r\n            Valor.error(\"Non existe ningunha casilla co nome.\"+ partes[1]);\r\n            return;\r\n        }\r\n        if(casillaHipotecar.getDuenho() != jugadorActual){\r\n            Valor.error(\"A casilla \"+casillaHipotecar.getNombre()+\" non é da túa propiedade, non a podes hipotecar.\");\r\n            return;\r\n        }\r\n        if(casillaHipotecar.getHipotecada()){\r\n            Valor.error(\"A casilla \"+casillaHipotecar.getNombre()+\" xa está hipotecada.\");\r\n            return;\r\n        }\r\n        if(casillaHipotecar.getTipo().equals(\"Solar\")){\r\n            if(casillaHipotecar.getEdificios().get(\"casa\").getNumCasas()>0){\r\n                Valor.error(\"Esta propiedade ten \"+casillaHipotecar.getEdificios().get(\"casa\").getNumCasas()+\" casas construídas, debes vender as casas antes de hipotecar.\");\r\n                return;\r\n            }\r\n            if(casillaHipotecar.getEdificios().get(\"hotel\").getTenEdificio()||casillaHipotecar.getEdificios().get(\"piscina\").getTenEdificio()||casillaHipotecar.getEdificios().get(\"deporte\").getTenEdificio()){\r\n                Valor.error(\"Esta propiedade ten un algún edificio construído, debes vendelo antes de hipotecar.\");\r\n                return;\r\n            }\r\n\r\n    }\r\n        casillaHipotecar.hipotecarCasilla();\r\n}\r\n    private void deshipotecar(String[] partes){\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        Casilla casillaDeshipotecar = tablero.encontrar_casilla(partes[1]);    \r\n        if(casillaDeshipotecar==null){\r\n            Valor.error(\"Non existe ningunha casilla co nome.\"+ partes[1]);\r\n            return;\r\n        }\r\n        if(casillaDeshipotecar.getTipo().equals(\"Solar\")){\r\n            Valor.error(\"Solo se poden deshipotecar solares.\");\r\n            return;\r\n        }\r\n        if(casillaDeshipotecar.getDuenho() != jugadorActual){\r\n            Valor.error(\"A casilla \"+casillaDeshipotecar.getNombre()+\" non é da túa propiedade, non a podes deshipotecar.\");\r\n            return;\r\n        }\r\n        if(casillaDeshipotecar.getHipotecada()==false){\r\n            Valor.error(\"A casilla \"+casillaDeshipotecar.getNombre()+\" non está hipotecada.\");\r\n            return;\r\n        }\r\n        casillaDeshipotecar.deshipotecarCasilla();\r\n    }\r\n    // Metodo que realiza las acciones asociadas al comando 'listar avatares'.\r\n    private void listarAvatares() {\r\n\r\n    }\r\n\r\n    // Metodo que realiza las acciones asociadas al comando 'acabar turno'.\r\n    private void acabarTurno() {\r\n        //Comprobar que a partida está empezada\r\n        if(!tirado){\r\n            System.out.println(\"Aínda tes que tirar os dados.\");\r\n            return;\r\n        }\r\n        Jugador jugadorActual= jugadores.get(turno);\r\n        if(jugadorActual.getEnCarcel() && jugadorActual.getTiradasCarcel()==3){\r\n            if(jugadorActual.getFortuna()<500000){\r\n                Valor.error(\"Non tes cartos para saír do cárcere (500000€) ...\");\r\n                solvente=false;\r\n                //return; En futuras entregas onde podas recaudar cartos vendendo e hipotecando propiedades, non se pode facer return aquí, porque podes conseguir cartos e pagar a multa\r\n            }else{\r\n                solvente=true;\r\n                jugadorActual.sumarFortuna(-500000);\r\n                jugadorActual.setEnCarcel(false);\r\n                jugadorActual.setTiradasCarcel(0);\r\n                System.out.println(\"Saíches automaticamente do cárcere tras tres turnos.\\nPagaches 500000€ como multa dude.\");\r\n            }\r\n\r\n        }\r\n        if(!solvente){\r\n            Jugador Recaudador = jugadorActual.getAvatar().getLugar().getDuenho();\r\n            System.out.println(\"\\nNon pagaches as débedas.\");\r\n            bancarrota(jugadorActual, Recaudador);\r\n            //solvente = jugadorActual.getAvatar().getLugar().evaluarCasilla(jugadorActual,banca,0); <-non ten sentido facer aquí solvente, xa se fai cando tiras os dados.\r\n            //^^, senón tiras os dados, non cambia o teu estado do xogo. Con saber en que casilla estás xa sabes a quen lle debes os cartos\r\n            //^^ non lle vas pagar a ningúen máis que ao xogador da casilla que che fixo perder os cartos\r\n            System.out.println(\"\\nTurno acabado. O xogador \"+ jugadorActual.getNombre()+ \" foi eliminado. \\n\");\r\n            jugadores.remove(turno);\r\n            if(jugadores.size()==1){\r\n                turno =0;\r\n                partidaFinalizada = finalizarPartida();\r\n                return;\r\n                //Impide inmediatamente que se poida realizar calquera outra acción.\r\n\r\n            }\r\n        //Esto entendo que pode ser exactamente igual, non hai por que facer return realmente (mentres queden xogadores)\r\n        }\r\n        tirado=false;\r\n        lanzamientos=0;\r\n        turno++;\r\n        if(turno==jugadores.size()){\r\n            turno=0;\r\n        }\r\n\r\n        if(!partidaFinalizada)\r\n        {\r\n            System.out.println(\"Turno acabado. Agora é o turno de \"+jugadores.get(turno).getNombre()+\".\");\r\n        }\r\n    }\r\n\r\n    private void bancarrota(Jugador endeudado, Jugador Recaudador){\r\n    //Quitaránse todas as propidedades do xogar endeudado e daranse ao outro xogador/banca\r\n        if(Recaudador == this.banca){\r\n            System.out.println(\"\\nTodas as propiedades do xogador \"+endeudado.getNombre()+\" serán traspasadas á Banca.\\n\");\r\n        }else{\r\n            System.out.println(\"\\nAs propiedades de \"+endeudado.getNombre()+\" serán revocadas a \"+Recaudador.getNombre()+\".\\n\");\r\n        }\r\n        if(!endeudado.getPropiedades().isEmpty()){\r\n            for(Casilla aux: endeudado.getPropiedades()) {\r\n                aux.setDueño(Recaudador);\r\n            }\r\n        }else{\r\n                System.out.println(\"\\nO xogador endeudado non ten propiedades...\");\r\n            }\r\n\r\n    }\r\n\r\n    private void leerArquivo(String nomeArquivo){\r\n        this.comandos = true;\r\n        try {\r\n            java.io.File archivo = new java.io.File(nomeArquivo);\r\n            Scanner lector = new Scanner(archivo);\r\n            ArrayList<String> comandos = new ArrayList<String>();\r\n            \r\n            while(lector.hasNextLine()) {\r\n                comandos.add(lector.nextLine());\r\n            }\r\n            lector.close();\r\n            \r\n            for(String comando : comandos) {\r\n                if(!comando.trim().isEmpty()) {\r\n                    System.out.println(\"Executando: \" + comando);\r\n                    analizarComando(comando);\r\n                }\r\n            }\r\n        } catch (java.io.FileNotFoundException e) {\r\n            System.out.println(\"Non se atopou o arquivo: \" + nomeArquivo);\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n            System.out.println(\"Error ao ler o arquivo: \" + e.getMessage());\r\n        }\r\n        this.comandos = false;\r\n    }\r\n    private boolean finalizarPartida(){\r\n        Jugador ganhador = jugadores.get(0);\r\n        System.out.println(\"\\nO Gañador da partida foi \"+ganhador.getNombre() + \", felicidades!\\n\");\r\n        System.out.println(\"Rematou a partida con \" + ganhador.getFortuna()+\" $, e as súas propiedades son:\\n \");\r\n        System.out.println(\"{\\n\");\r\n        for(Casilla aux : ganhador.getPropiedades()){\r\n            System.out.println(aux.getNombre() + \"\\n\");\r\n        }\r\n        System.out.println(\"}\");\r\n    return true;\r\n    }\r\n    private void estadisticasPartida() {\r\n        boolean primeraComprada = false;\r\n        boolean grupoComprado = false;\r\n        double rentGrupoMax =-1*Math.pow(10,8);\r\n        double rentGrupoActual = 0;\r\n        Casilla casillaMax = this.tablero.getPosiciones().get(0).get(0); //Inicializamos casillaMax con la primera casilla del tablero tipo soloar\r\n        Casilla freqmax = this.tablero.getPosiciones().get(0).get(0);\r\n        for (ArrayList<Casilla> lado : this.tablero.getPosiciones()) {\r\n            for (Casilla casilla : lado) {\r\n                if ((casilla.getTipo().equalsIgnoreCase(\"Transportes\") || casilla.getTipo().equalsIgnoreCase(\"Servicios\") || casilla.getTipo().equalsIgnoreCase(\"Solar\")) && casilla.getDuenho() != banca) {\r\n                    if ((casilla.getRentabilidad() > casillaMax.getRentabilidad() || casillaMax.getDuenho() == banca)) {\r\n                        casillaMax = casilla;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        Set<String> set = this.tablero.getGrupos().keySet();\r\n        Grupo grupomax = null;\r\n        for (String key : set) {\r\n            Grupo grupo=this.tablero.getGrupos().get(key);\r\n            grupoComprado = false;\r\n            for(Casilla aux: grupo.getMiembros()){\r\n                if(aux.getDuenho()!=banca){\r\n                    rentGrupoActual+=aux.getRentabilidad();\r\n                    grupoComprado = true;\r\n                }\r\n            }\r\n            if(rentGrupoActual>rentGrupoMax && grupoComprado){\r\n                rentGrupoMax=rentGrupoActual;\r\n                grupomax=grupo;\r\n            }\r\n\r\n        }\r\n        if (casillaMax.getDuenho() == banca) {\r\n            System.out.println(\"\\n -*Ningunha propiedade foi comprada aínda.\\n\");\r\n            primeraComprada = false;\r\n        }else{\r\n            System.out.println(\" -*Casilla máis rentable: \"+casillaMax.getNombre()+\".\\n\");\r\n            primeraComprada = true;\r\n        }\r\n        for (ArrayList<Casilla> lado : this.tablero.getPosiciones()) {\r\n            for (Casilla aux : lado) {\r\n                    if (aux.getCaidas() > freqmax.getCaidas()) {\r\n                        freqmax = aux;\r\n                }\r\n            }\r\n        }\r\n        if(grupoComprado){\r\n            System.out.println(\" -*O grupo máis rentable é: \"+grupomax.getColorGrupo());\r\n        }else{\r\n            System.out.println(\" -*Ningún grupo foi comprado aínda.\\n\");\r\n        }\r\n        System.out.println(\" -*Casilla máis frecuentada: \"+freqmax.getNombre()+\", cunha frecuencia de \"+freqmax.getCaidas()+\" caidas.\\n\");\r\n        //Jugador voltasmax = jugadores.get(0);\r\n        ArrayList<Jugador> topvoltas = new ArrayList<>(); //vou probar cunha lista para os empates\r\n        ArrayList<Jugador> topfortunas = new ArrayList<>();\r\n        topfortunas.add(jugadores.get(0));\r\n        topvoltas.add(jugadores.get(0));\r\n        //Jugador fortunamax = jugadores.get(0);\r\n        for(Jugador aux: jugadores){\r\n            float voltasaux = aux.getEstatisticas().getVoltasDadas();\r\n            float cartosaux = aux.getFortuna()+aux.getEstatisticas().getDineroInvertido();\r\n            if(voltasaux>topvoltas.get(0).getEstatisticas().getVoltasDadas()){\r\n                //facemos unha lista co top de players con máis voltas\r\n                for(int i = 0; i<topvoltas.toArray().length; i++){\r\n                    topvoltas.remove(i);\r\n                }\r\n                topvoltas.add(aux);\r\n            }else if(voltasaux == topvoltas.get(0).getEstatisticas().getVoltasDadas() &&!topvoltas.contains(aux)){\r\n                topvoltas.add(aux);\r\n            }\r\n                //repetimos o proceso pero cos cartos\r\n            if(cartosaux>topfortunas.get(0).getFortuna()+topfortunas.get(0).getEstatisticas().getDineroInvertido()){\r\n                //facemos unha lista co top de players con máis voltas\r\n                for(int i = 0; i<topfortunas.toArray().length; i++){\r\n                    topfortunas.remove(i);\r\n                }\r\n                topfortunas.add(aux);\r\n            }else if(cartosaux == (topfortunas.get(0).getFortuna()+topfortunas.get(0).getEstatisticas().getDineroInvertido()) && !topfortunas.contains(aux)){\r\n                topfortunas.add(aux);\r\n            }\r\n\r\n        }\r\n        /*Déixoo comentado por se a solución anterior era mellor\r\n        *  for(Jugador aux: jugadores){\r\n            if(aux.getEstatisticas().getVoltasDadas()>voltasmax.getEstatisticas().getVoltasDadas()){\r\n                voltasmax = aux;\r\n            }\r\n            if(aux.getFortuna()>fortunamax.getFortuna()){\r\n                fortunamax = aux;\r\n            }\r\n        }\r\n        if(voltasmax.getEstatisticas().getVoltasDadas()!=0){\r\n            System.out.println(\" -*Xogador con máis voltas: \"+voltasmax.getNombre()+\".\\n\");\r\n        }else{\r\n            System.out.println(\" -*Ningún xogador ten voltas todavía.\\n\");\r\n        }\r\n\r\n        System.out.println(\" -*Xogador en cabeza: \"+fortunamax.getNombre()+\", con unha fortuna de \"+fortunamax.getFortuna()+\" €.\\n\");\r\n\r\n        *\r\n        *\r\n        * */\r\n        if(topvoltas.get(0).getEstatisticas().getVoltasDadas() == 0){\r\n            System.out.println(\" -*Ningún xogador ten voltas todavía.\\n\");\r\n        }else if(topvoltas.size()==1){\r\n            System.out.println(\" -*Xogador con máis voltas (\"+ topvoltas.get(0).getEstatisticas().getVoltasDadas()+\"): \"+topvoltas.get(0).getNombre()+\".\\n\");\r\n        }else{\r\n            System.out.println(\" -*Xogadores con máis voltas (\"+ topvoltas.get(0).getEstatisticas().getVoltasDadas()+\"): \\n\");\r\n            for(Jugador aux: topvoltas){\r\n                System.out.println(\"\\t- \"+ aux.getNombre()+\"\\n\");\r\n            }\r\n        }\r\n        if(topfortunas.size()==1){\r\n            System.out.println(\" -*Xogador con máis fortuna(\"+(topfortunas.get(0).getFortuna()+topfortunas.get(0).getEstatisticas().getDineroInvertido())+\"): \"+topfortunas.get(0).getNombre()+\".\\n\");\r\n        }else {\r\n            System.out.println(\" -*Xogadores con máis fortuna(\"+(topfortunas.get(0).getFortuna()+topfortunas.get(0).getEstatisticas().getDineroInvertido())+\"):\\n\");\r\n            for (Jugador aux : topfortunas) {\r\n                System.out.println(\"\\t- \" + aux.getNombre() + \"\\n\");\r\n            }\r\n        }\r\n    }\r\n\r\n    private void estadisticasXogador(String[] comandos){\r\n        for(Jugador aux: jugadores){\r\n            if(aux.getNombre().equalsIgnoreCase(comandos[1])){\r\n                System.out.println(aux.getEstatisticas());\r\n                return;\r\n            }\r\n        }\r\n        Valor.error(\"\\nNon existe ningún xogador con ese nome.\");\r\n        return;\r\n    }\r\n\r\n    private void mostrarAxuda(){\r\n        System.out.println(\r\n\r\n                \"\\033[1m Lista de comandos dispoñibles: \\033[0m\\n\" +\r\n                \"   -crear jugador <nombre> <tipo_avatar>\\n\" +\r\n                \"   -salir carcel\\n\" +\r\n                \"   -acabar turno\\n\" +\r\n                \"   -lanzar dados <dado1>+<dado2>\\n\" +\r\n                \"   -comprar <nombre_casilla>\\n\" +\r\n                \"   -edificar <tipo_edificio>\\n\" +\r\n                \"   -vender <tipo_edificio> <nombre_casilla> <num_edificios>\\n\" +\r\n                \"   -hipotecar <nombre_casilla>\\n\" +\r\n                \"   -deshipotecar <nombre_casilla>\\n\" +\r\n                \"   -listar jugadores\\n\" +\r\n                \"   -listar enventa\\n\" +\r\n                \"   -listar edificios <color_grupo>\\n\" +\r\n                \"   -describir jugador <nombre_jugador>\\n\" +\r\n                \"   -describir <nombre_casilla>\\n\" +\r\n                \"   -estadisticas [<nombre_jugador>]\\n\" +\r\n                \"   -comandos <nombre_archivo>\\n\"\r\n        );\r\n\r\n\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/monopoly/Menu.java b/monopoly/Menu.java
--- a/monopoly/Menu.java	(revision 24f84d39395e5f61e5171afd07e22b204cd9d204)
+++ b/monopoly/Menu.java	(date 1763505793891)
@@ -700,10 +700,6 @@
             Valor.error("Non existe ningunha casilla co nome."+ partes[1]);
             return;
         }
-        if(casillaDeshipotecar.getTipo().equals("Solar")){
-            Valor.error("Solo se poden deshipotecar solares.");
-            return;
-        }
         if(casillaDeshipotecar.getDuenho() != jugadorActual){
             Valor.error("A casilla "+casillaDeshipotecar.getNombre()+" non é da túa propiedade, non a podes deshipotecar.");
             return;
